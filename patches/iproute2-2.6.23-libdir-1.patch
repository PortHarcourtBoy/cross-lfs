Submitted By: Joe Ciccone <jciccone@linuxfromscratch.org>
Date: 2007-09-01
Upstream Status: Unknown
Origin: Joe Ciccone
Description: Changes the path of /usr/lib/tc to one defined in the Makefile.

diff -Naur iproute2-2.6.22-070710.orig/include/iptables.h iproute2-2.6.22-070710/include/iptables.h
--- iproute2-2.6.22-070710.orig/include/iptables.h	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/include/iptables.h	2007-09-02 08:29:41.000000000 -0700
@@ -5,7 +5,7 @@
 #include "libiptc/libiptc.h"
 
 #ifndef IPT_LIB_DIR
-#define IPT_LIB_DIR "/usr/local/lib/iptables"
+#define IPT_LIB_DIR LIBDIR
 #endif
 
 #ifndef IPPROTO_SCTP
diff -Naur iproute2-2.6.22-070710.orig/Makefile iproute2-2.6.22-070710/Makefile
--- iproute2-2.6.22-070710.orig/Makefile	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/Makefile	2007-09-02 08:38:27.000000000 -0700
@@ -1,5 +1,7 @@
 DESTDIR=
 SBINDIR=/usr/sbin
+LIBDIR=/usr/lib
+VARLIB=/var/lib
 CONFDIR=/etc/iproute2
 DOCDIR=/usr/share/doc/iproute2
 MANDIR=/usr/share/man
@@ -22,7 +24,7 @@
 CC = gcc
 HOSTCC = gcc
 CCOPTS = -D_GNU_SOURCE -O2 -Wstrict-prototypes -Wall
-CFLAGS = $(CCOPTS) -I../include $(DEFINES)
+CFLAGS = -DLIBDIR=\"$(LIBDIR)\" -DVARLIB=\"$(VARLIB)\" $(CCOPTS) -I../include $(DEFINES)
 YACCFLAGS = -d -t -v
 
 LDLIBS += -L../lib -lnetlink -lutil
diff -Naur iproute2-2.6.22-070710.orig/misc/arpd.c iproute2-2.6.22-070710/misc/arpd.c
--- iproute2-2.6.22-070710.orig/misc/arpd.c	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/misc/arpd.c	2007-09-02 08:38:08.000000000 -0700
@@ -40,7 +40,7 @@
 int resolve_hosts;
 
 DB	*dbase;
-char	*dbname = "/var/lib/arpd/arpd.db";
+char	*dbname = VARLIB "/arpd/arpd.db";
 
 int	ifnum;
 int	*ifvec;
diff -Naur iproute2-2.6.22-070710.orig/netem/Makefile iproute2-2.6.22-070710/netem/Makefile
--- iproute2-2.6.22-070710.orig/netem/Makefile	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/netem/Makefile	2007-09-02 08:29:41.000000000 -0700
@@ -4,6 +4,8 @@
 HOSTCC ?= $(CC)
 LDLIBS += -lm 
 
+LIBDIR = /usr/lib
+
 all: $(DISTGEN) $(DISTDATA)
 
 $(DISTGEN):
@@ -19,9 +21,9 @@
 	$(HOSTCC) $(CCOPTS) -I../include -o $@ $@.c -lm
 
 install: all
-	mkdir -p $(DESTDIR)/usr/lib/tc
+	mkdir -p $(DESTDIR)/$(LIBDIR)/tc
 	for i in $(DISTDATA); \
-	do install -m 755 $$i $(DESTDIR)/usr/lib/tc; \
+	do install -m 755 $$i $(DESTDIR)/$(LIBDIR)/tc; \
 	done
 
 clean:
diff -Naur iproute2-2.6.22-070710.orig/tc/Makefile iproute2-2.6.22-070710/tc/Makefile
--- iproute2-2.6.22-070710.orig/tc/Makefile	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/tc/Makefile	2007-09-02 08:29:41.000000000 -0700
@@ -69,10 +69,10 @@
 	$(AR) rcs $@ $(TCLIB)
 
 install: all
-	mkdir -p $(DESTDIR)/usr/lib/tc
+	mkdir -p $(DESTDIR)/$(LIBDIR)/tc
 	install -m 0755 -s tc $(DESTDIR)$(SBINDIR)
 	for i in $(TCSO); \
-	do install -m 755 -s $$i $(DESTDIR)/usr/lib/tc; \
+	do install -m 755 -s $$i $(DESTDIR)/$(LIBDIR)/tc; \
 	done
 
 clean:
diff -Naur iproute2-2.6.22-070710.orig/tc/tc_util.c iproute2-2.6.22-070710/tc/tc_util.c
--- iproute2-2.6.22-070710.orig/tc/tc_util.c	2007-07-10 18:34:14.000000000 -0700
+++ iproute2-2.6.22-070710/tc/tc_util.c	2007-09-02 08:33:48.000000000 -0700
@@ -30,7 +30,7 @@
 
 	lib_dir = getenv("TC_LIB_DIR");
 	if (!lib_dir)
-		lib_dir = "/usr/lib/tc";
+		lib_dir = LIBDIR "/tc";
 
 	return lib_dir;
 }
