########################################################################
#
# Description : 65-md-raid.rules
#
# Authors     : Based on Open Suse Udev Rules
#               kay.sievers@suse.de
#
# Adapted to  : Jim Gifford
# LFS
#
# Version     : 00.01
#
# Notes       : This is where you can put rules that are a part
#               of this package
#
# Requirements: mdadm 2.6.2 or higher
#
########################################################################

# md links hook into "change" events, when the array becomes available

SUBSYSTEM!="block",	GOTO="md_raid_end"
KERNEL!="md[0-9]*",	GOTO="md_raid_end"
ACTION!="add|change",	GOTO="md_raid_end"

ATTR{md/array_state}=="|clear|inactive", GOTO="md_raid_end"

IMPORT{program}="/sbin/mdadm -D --export $tempnode"
ENV{MD_NAME}=="?*",	SYMLINK+="disk/by-id/md-name-$env{MD_NAME}"
ENV{MD_UUID}=="?*",	SYMLINK+="disk/by-id/md-uuid-$env{MD_UUID}"

IMPORT{program}="vol_id --export $tempnode"
OPTIONS="link_priority=100"
ENV{ID_FS_USAGE}=="filesystem|other|crypto",	ENV{ID_FS_UUID_ENC}=="?*", SYMLINK+="disk/by-uuid/$env{ID_FS_UUID_ENC}"
ENV{ID_FS_USAGE}=="filesystem|other",		ENV{ID_FS_LABEL_ENC}=="?*", SYMLINK+="disk/by-label/$env{ID_FS_LABEL_ENC}"

LABEL="md_raid_end"
