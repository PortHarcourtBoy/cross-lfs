########################################################################
#
# Description : 64-device-mapper.rules
#
# Authors     : Based on Open Suse Udev Rules
#               kay.sievers@suse.de
#
# Adapted to  : Jim Gifford
# LFS
#
# Version     : 00.01
#
# Notes       : This is where you can put rules that are a part
#               of this package
#
# Requirements: mdadm 2.6.2 or higher
#
########################################################################

KERNEL=="device-mapper",	SYMLINK+="mapper/control"

KERNEL!="dm-*",		GOTO="device_mapper_end"
ACTION!="add|change",	GOTO="device_mapper_end"

# skip snapshot and error tables
IMPORT{program}="/sbin/dmsetup export -j%M -m%m"
ENV{DM_STATE}!="ACTIVE",			GOTO="device_mapper_end"
ENV{DM_TARGET_TYPES}=="|*error*",		GOTO="device_mapper_end"

SYMLINK+="disk/by-id/dm-name-$env{DM_NAME}"
ENV{DM_UUID}=="?*", SYMLINK+="disk/by-id/dm-uuid-$env{DM_UUID}"

IMPORT{program}="vol_id --export $tempnode"
OPTIONS="link_priority=-100"
ENV{ID_FS_USAGE}=="filesystem|other|crypto",	ENV{ID_FS_UUID_ENC}=="?*", SYMLINK+="disk/by-uuid/$env{ID_FS_UUID_ENC}"
ENV{ID_FS_USAGE}=="filesystem|other",		ENV{ID_FS_LABEL_ENC}=="?*", SYMLINK+="disk/by-label/$env{ID_FS_LABEL_ENC}"

LABEL="device_mapper_end"
